<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Nanosatellite embedded workshop</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="Prerequisite_1.html"><strong aria-hidden="true">1.</strong> Prerequisite</a></li><li class="chapter-item expanded "><a href="System_overview_2.html"><strong aria-hidden="true">2.</strong> System overview</a></li><li class="chapter-item expanded "><a href="Exercises.html"><strong aria-hidden="true">3.</strong> Exercises</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Nanosatellite embedded workshop</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/AeroRust/nanosat-workshop" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="prerequisite---chapter-1"><a class="header" href="#prerequisite---chapter-1">Prerequisite - Chapter 1</a></h1>
<ol>
<li>Install Rust using <code>rustup</code> - <a href="https://www.rust-lang.org/tools/install">https://www.rust-lang.org/tools/install</a></li>
<li>Setup git - you will also need to set your <code>ssh</code> key in Github to:
<ul>
<li><a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">Generating a new SSH key and adding it to the ssh-agent (Github)</a></li>
<li><a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account">Adding a new SSH key to your GitHub account</a></li>
</ul>
</li>
<li>Clone repository: <code>git clone git@github.com:LechevSpace/nanosat-workshop.git</code></li>
<li>Install RiscV toolchain: <code>rustup target install riscv32imac-unknown-none-elf</code></li>
<li>Build the application: <code>cd nanosat-workshop &amp;&amp; cargo build</code></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="system-overview"><a class="header" href="#system-overview">System overview</a></h1>
<p><img src="System_Block_Diagram.jpg" alt="System block diagram" /></p>
<p>2 solar panels connected to solar charging board CN 3791 which is connected to system (VCC &amp; GND) to <a href="https://www.olimex.com/Products/IoT/ESP32-C3/ESP32-C3-DevKit-Lipo/">Olimex ESP32-C3 (rev. 1)</a> and the <a href="https://github.com/esp-rs/esp-rust-board/tree/v1.2">ESP32-C3 Rust dev kit (tag v1.2)</a> by <a href="https://www.espressif.com/en/products/devkits">Espressif</a></p>
<p>The output for the battery on the solar charger is connected a switch to disconnect power going towards the battery and then connected to a <a href="https://www.olimex.com/Products/Power/Lipo-battery/BATTERY-LIPO250mAh/">LiPo 3.7V battery of 250 mAh</a> (<a href="https://www.olimex.com/Products/Power/Lipo-battery/BATTERY-LIPO250mAh/resources/JA602025P-Spec-Data-Sheet-3.7V-250mAh--170116.pdf">Datasheet</a>).</p>
<p>On the connection to the battery, there's also a pin for ADC to the Olimex board for taking measurements of the battery. This allows us to read the battery percentage without charging it through the solar charger or USB (e.g. when we're programming the board).</p>
<pre><code>Charge voltage 4.2V, nominal voltage 3.7V, cut-off voltage 3.0V
Recommended charge current 50mA
Max charge current 125mA
Recommended discharge current 125mA
Max discharge current 250mA
Impedance 60mOhm at 1KHz
Operating temperature: at charge 0-55C, at discharge -25C+60C
Capacity loss after 500 cycles full charge/discharge at 20C: 20%
Dimensions 27x21x5mm
</code></pre>
<h2 id="bill-of-materials-bom"><a class="header" href="#bill-of-materials-bom">Bill of materials (BOM)</a></h2>
<p><img src="BOM.jpg" alt="Bill of materials (picture)" /></p>
<h3 id="components"><a class="header" href="#components">Components</a></h3>
<ul>
<li>
<p>1 x Olimex board (<code>ESP32-C3-DevKit-Lipo</code>): https://www.olimex.com/Products/IoT/ESP32-C3/ESP32-C3-DevKit-Lipo/</p>
</li>
<li>
<p>1 x Espressif Rust board (ESP32-C3): https://www.espressif.com/en/products/devkits (<code>ESP32-C3-DevKit-RUST-1</code>)</p>
</li>
<li>
<p>LiPo Battery - 250 mAh or larger (3.0V cut-off, 3.7V nominal and 4.2V max, with overcharge and over-current protection)</p>
</li>
<li>
<p>2 x Breadboards (Dimensions 82x52x10mm, Power supply bus on top and bottom, Grid on 0.1&quot; step)</p>
</li>
<li>
<p>2 x solar panels (80x80 mm, 6V) with JST-PH 2.0 male connectors (separately soldered)</p>
</li>
<li>
<p>1 x solar charger (CN3791 with 2 solar panel connectors JST-PH 2.0)</p>
<ul>
<li>Includes 2 cables JST-PH 2.0 (male) on both sides</li>
</ul>
</li>
<li>
<p>2 x JST-PH to 2 pin header connectors for breadboarding</p>
</li>
<li>
<p>2 x resistors (470k Ohms, 1%) - used for the Voltage divider which we use to measure the battery</p>
</li>
<li>
<p>3 x male to male jumper cables - 2 for UART (RX &amp; TX) and 1 for ADC.</p>
</li>
<li>
<p>2 x male to female jumper cables - for powering the Espressif board (BAT+ &amp; GND pins) from the solar charger</p>
</li>
<li>
<p>USB-C to USB-B / USB-C to USB-C cable for programming (depends on your development machine)</p>
</li>
</ul>
<h2 id="frame"><a class="header" href="#frame">Frame</a></h2>
<ul>
<li>5 x M3 L10 bolts</li>
<li>5 x M3 nuts</li>
<li>1 x 3D printed frame - consists of 3 distinct sides (bottom, front and right)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="boards-applications"><a class="header" href="#boards-applications">Board's applications</a></h2>
<p>Both applications are structured in the following way to allow you to follow the exercises:</p>
<ul>
<li><code>Application::init</code> - initialise any peripheral that will be used for the <code>Application</code>
<ul>
<li><a href="./skeleton/riscv32imac-unknown-none-elf/doc/power_system/application/struct.Application.html#method.init"><code>power_system::Application::init</code></a></li>
<li><a href="./skeleton/riscv32imac-unknown-none-elf/doc/onboard_computer/application/struct.Application.html#method.init"><code>onboard_computer::Application::init</code></a></li>
</ul>
</li>
</ul>
<ul>
<li><code>Application:run</code> - spawns all tasks on the embassy executor needed for our <code>Application</code>.
<ul>
<li><a href="./skeleton/riscv32imac-unknown-none-elf/doc/power_system/application/struct.Application.html#method.run"><code>power_system::Application::run</code></a></li>
<li><a href="./skeleton/riscv32imac-unknown-none-elf/doc/onboard_computer/application/struct.Application.html#method.run"><code>onboard_computer::Application::run</code></a></li>
<li><code>power_system::Application::init</code></li>
</ul>
</li>
<li>An embassy task <code>fn run_*(..)</code> for each exercise</li>
</ul>
<h3 id="power-system-application-power-system-folder"><a class="header" href="#power-system-application-power-system-folder">Power System Application (<code>power-system</code> folder)</a></h3>
<h4 id="battery-and-power-sense"><a class="header" href="#battery-and-power-sense">Battery and power sense</a></h4>
<p><img src="./olimex_battery_and_power_sense.png" alt="Olimex schematic for GPIO 3 and 4" title="Battery (GPIO 3) and power Sense (GPIO4) GPIOs" /></p>
<h3 id="onboard-computer-onboard-computer-folder"><a class="header" href="#onboard-computer-onboard-computer-folder">Onboard-computer (<code>onboard-computer</code> folder)</a></h3>
<h4 id="peripherals"><a class="header" href="#peripherals">Peripherals</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Peripheral</th><th>Part number</th><th>Crate</th><th>Address</th></tr></thead><tbody>
<tr><td>IMU</td><td>ICM-42670-P (<a href="https://invensense.tdk.com/download-pdf/icm-42670-p-datasheet/">Datasheet</a>)</td><td><a href="https://crates.io/crates/icm42670">icm42670</a></td><td><code>0x68</code></td></tr>
<tr><td>Temperature and Humidity</td><td>SHTC3 (<a href="https://www.mouser.com/datasheet/2/682/Sensirion_04202018_HT_DS_SHTC3_Preliminiary_D2-1323493.pdf">Datasheet</a>)</td><td><a href="https://crates.io/crates/shtcx">shtcx</a></td><td><code>0x70</code></td></tr>
</tbody></table>
</div>
<h2 id="exercises"><a class="header" href="#exercises">Exercises</a></h2>
<p>Start with the <a href="./skeleton/riscv32imac-unknown-none-elf/doc/power_system/index.html"><code>power-system</code></a>:</p>
<ol>
<li>Flashing Onboard LED - a blinky example for IO - <a href="./skeleton/riscv32imac-unknown-none-elf/doc/power_system/application/fn.run_blinky.html"><code>power_system::application::run_blinky</code></a></li>
<li>Battery measurement with ADC - measure and calculate the battery voltage and percentage - <a href="./skeleton/riscv32imac-unknown-none-elf/doc/power_system/application/fn.run_battery_measurement_adc.html"><code>power_system::application::run_battery_measurement_adc</code></a></li>
<li>Send Battery percentage over UART to the <code>onboard-computer</code> - <a href="./skeleton/riscv32imac-unknown-none-elf/doc/power_system/application/fn.run_uart.html"><code>power_system::application::run_uart</code></a></li>
</ol>
<p>Continue with the next exercises in the <a href="./skeleton/riscv32imac-unknown-none-elf/doc/onboard_computer/index.html"><code>onboard-computer</code></a>:</p>
<ol>
<li>Receive battery percentage over UART from the <code>power-system</code> - <a href="./skeleton/riscv32imac-unknown-none-elf/doc/onboard_computer/application/fn.run_uart.html"><code>onboard_computer::application::run_uart</code></a></li>
<li>GNSS receiver - parse NMEA 0183 sentences - <a href="./skeleton/riscv32imac-unknown-none-elf/doc/onboard_computer/application/fn.run_gnss.html"><code>onboard_computer::application::run_gnss</code></a></li>
</ol>
<h2 id="future-ideas-you-can-develop"><a class="header" href="#future-ideas-you-can-develop">Future ideas you can develop</a></h2>
<p>In no particular order:</p>
<ul>
<li>
<p>Power sense (<code>power-system</code> application)</p>
<p>By soldering the jumper for <code>GPIO 4</code> you can measure the voltage of the +5V Power in line.
This allows you to know whether or not an external +5V has been provided (both from USB-C or other), that will
charge the battery.
Implement another status for the battery which is Charging/External power.</p>
</li>
<li>
<p>IMU (<code>onboard-computer</code> application)
Using the <strong>I2C</strong> peripheral and the included IMU sensor on the <code>onboard-computer</code>, take readings of the </p>
</li>
<li>
<p>Humidity and Temperature sensor (<code>onboard-computer</code> application)</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
